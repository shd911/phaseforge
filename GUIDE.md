# PhaseForge — Краткое руководство

## О программе
PhaseForge — инструмент для создания корректирующих FIR-фильтров акустических систем. Работает с замерами из REW, генерирует WAV-импульсы для загрузки в конвольвер.

---

## Быстрый старт

### 1. Создайте полосы
Внизу окна — вкладки полос. Кнопка **+** добавляет полосу, **×** удаляет (при наведении). Перетаскивание меняет порядок. Порядок слева направо = от НЧ к ВЧ.

### 2. Загрузите замеры
Вкладка **Measurements** → кнопка **Import**. Поддерживаются `.txt` (REW) и `.frd`. Программа автоматически:
- компенсирует задержку распространения
- нормализует уровень
- показывает расстояние до микрофона

**Сглаживание** — выпадающий список: 1/3, 1/6, 1/12, 1/24 окт или Variable.

**Merge NF+FF** — сшивка ближнего и дальнего поля. Ползунок splice-частоты (50–1000 Гц).

### 3. Настройте таргет
Вкладка **Target**:
- **Пресет**: Flat / Harman / B&K / X-Curve / Custom
- **Tilt**: наклон АЧХ в дБ/окт (типично -0.5 для комнаты)
- **Reference level**: общий сдвиг уровня
- **High-Pass / Low-Pass**: тип (Butterworth, LR, Bessel, Gaussian), порядок, частота, галочка Linear Phase
- **Low Shelf / High Shelf**: частота, усиление, добротность
- **NOR/INV**: инверсия полярности (+180°)

### 4. Свяжите кроссоверы
Кнопка **🔗** рядом с Low-Pass связывает его с High-Pass следующей полосы. При изменении частоты одного — второй обновляется автоматически.

В режиме **SUM** кроссоверы видны как оранжевые маркеры на графике — их можно перетаскивать мышью.

### 5. Подберите PEQ
Вкладка **Auto Align**:
- Задайте **Tolerance** (допустимая неравномерность) и **Max bands** (число фильтров)
- Нажмите **Optimize PEQ**
- Результат — таблица PEQ-фильтров справа (частота / усиление / добротность)
- Каждый фильтр можно отредактировать вручную, включить/выключить, удалить
- **Двойной клик** на графике добавляет PEQ на частоте курсора
- Мини-график импульса внизу справа показывает результат коррекции

### 6. Экспортируйте FIR
Вкладка **Export**:
- Выберите **Sample Rate** (48k по умолчанию)
- Выберите **Taps** (65K по умолчанию, больше = точнее на НЧ)
- Выберите **Window** (Blackman по умолчанию)
- Режим фазы определяется автоматически: Linear-Phase если все фильтры линейно-фазовые, иначе Minimum-Phase
- Нажмите **Export WAV** → выберите путь сохранения
- Загрузите WAV в конвольвер (CamillaDSP, brutefir, Acourate и т.д.)

---

## Интерфейс

```
┌─ Верхняя панель ──────────────────────────────────────┐
│ PhaseForge │ File │ [Mag] [Phase] [Target] │ Инфо     │
├─ Вкладки полос ───────────────────────────────────────┤
│ [Band 1 ×] [Band 2 ×] [Band 3 ×] [+]       [SUM]    │
├───────────────────────────────────────────────────────┤
│ ┌─ График АЧХ/Фазы ─────────────────┐ ┌─ PEQ ──────┐│
│ │ Замер · Таргет · Corrected         │ │ Таблица    ││
│ │ [+][-][▲][▼][FIT]  [+][-][◀][▶]   │ │ фильтров   ││
│ └────────────────────────────────────┘ │            ││
│ ┌─ Панель управления (вкладки) ──────┐ │ Импульс   ││
│ │ Measurements │ Target │ Align │ Export │            ││
│ └────────────────────────────────────┘ └────────────┘│
└───────────────────────────────────────────────────────┘
```

### Управление графиком
| Кнопка | Действие |
|--------|----------|
| **+** / **−** (вертикаль) | Зум по уровню (центрируется на passband) |
| **▲** / **▼** | Прокрутка вверх/вниз |
| **+** / **−** (горизонталь) | Зум по частоте |
| **◀** / **▶** | Прокрутка влево/вправо |
| **FIT** | Вернуть масштаб по умолчанию |

### Горячие клавиши
| Клавиша | Действие |
|---------|----------|
| ⌘N | Новый проект |
| ⌘O | Открыть проект |
| ⌘S | Сохранить |
| ⌘⇧S | Сохранить как |

---

## Режим SUM
Вкладка **SUM** показывает суммарный отклик всех полос. Над графиком — матрица видимости:

```
         │ Band 1 │ Band 2 │ Band 3 │  Σ  │
─────────┼────────┼────────┼────────┼─────┤
Targets  │   ◼    │   ◼    │   ◼    │  ◼  │  ← клик = toggle строки
Meas     │        │   ◼    │        │  ◼  │
Corrected│        │   ◼    │        │  ◼  │
         │  клик = toggle столбца          │
```

Клик по ячейке — показать/скрыть кривую. Клик по заголовку строки — toggle категории. Клик по заголовку столбца — toggle полосы.

---

## Типичный workflow (3-way система)

1. Создать 3 полосы: Bass / Mid / Tweeter
2. Загрузить замер каждого динамика
3. Настроить кроссоверы: Bass LP 300 🔗 Mid HP 300, Mid LP 4k 🔗 Tweeter HP 4k
4. Выбрать пресет таргета (Harman), подстроить tilt
5. Auto-Align PEQ для каждой полосы
6. Проверить SUM — суммарная АЧХ + фаза
7. Export → 3 WAV файла → загрузить в конвольвер
